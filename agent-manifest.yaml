Descriptor:
  Name: PolicyIntelligenceAgent
  DisplayName: Policy Intelligence Agent
  Description: >-
    An interactive agent that performs deep analysis of Intune policies. It
    summarizes policies, assesses end-user and security impact, reports
    assignments with filters, detects conflicts, maps compliance frameworks, and
    generates exportable reports. Leverages the built-in Intune skills in
    Security Copilot for accurate, tenant-specific analysis.
  Icon: ''

AgentDefinitions:
  - Name: PolicyIntelligenceAgent
    DisplayName: Policy Intelligence Agent
    Description: >-
      An interactive agent that performs deep analysis of Intune policies. It
      summarizes policies, assesses end-user and security impact, reports
      assignments with filters, detects conflicts, maps compliance frameworks, and
      generates exportable reports.
    Product: Microsoft Intune
    Publisher: IntuneStuff
    RequiredSkillsets:
      - PolicyIntelligenceAgent
      - Intune
    AgentSingleInstanceConstraint: Workspace
    Triggers:
      - Name: Default
        DefaultPollPeriodSeconds: 0
        ProcessSkill: PolicyIntelligenceAgent.PolicyIntelligenceAgent
    PromptSkill: PolicyIntelligenceAgent.PolicyIntelligenceAgent

SkillGroups:
  - Format: Agent
    Skills:
      - Name: PolicyIntelligenceAgent
        DisplayName: Policy Intelligence Agent
        Description: >-
          Orchestrates comprehensive Intune policy analysis by chaining built-in
          Intune skills to summarize policies, assess impact, report
          assignments, and detect conflicts.
        Interfaces:
          - InteractiveAgent
        Inputs:
          - Name: UserRequest
            Description: >-
              The user's request. Can be a policy name, policy ID, a question
              about policies, or a request to analyze specific policies.
            DefaultValue: List all my Intune configuration policies
            Required: false
        SuggestedPrompts:
          - Prompt: List all my Intune configuration policies
            Title: Browse Policies
            Personas:
              - 3
            IsStarterAgent: true
          - Prompt: >-
              Analyze my Windows security policies - summarize each one,
              show end-user impact, security impact, assignments with filters,
              and check for conflicts
            Title: Full Windows Policy Analysis
            Personas:
              - 3
            IsStarterAgent: true
          - Prompt: >-
              Show me all compliance policies and their assignments including
              any filters that are applied
            Title: Compliance & Assignments
            Personas:
              - 3
            IsStarterAgent: true
          - Prompt: >-
              Which of my Intune policies have conflicting settings?
              Check across all policy types.
            Title: Conflict Detection
            Personas:
              - 3
            IsStarterAgent: true
          - Prompt: Now show me the end-user impact for these policies
          - Prompt: What is the security impact of these policies?
          - Prompt: Show me all assignments and filters for these policies
          - Prompt: Check these policies for conflicts with other policies
          - Prompt: Which compliance frameworks do these policies satisfy?
          - Prompt: Generate a full report for these policies
        Settings:
          OrchestratorSkill: DefaultAgentOrchestrator
          ChildSkills:
            - DescribeIntunePolicy
            - GetIntuneDeviceDiff
            - GetIntuneDevices
            - GetIntuneDeviceGroupMemberships
            - IntunePolicyAdvisorRoutingSkill
          Instructions: |
            # Mission
            You are the Policy Intelligence Agent, an expert Intune policy analyst.
            You help IT administrators understand, audit, and optimize their Microsoft
            Intune policies through comprehensive analysis.

            # Available Tools
            You have access to Microsoft Intune tools. You MUST use them to query
            real data from the user's tenant:
            - **DescribeIntunePolicy** - Get full policy details. Pass the policy name.
            - **GetIntuneDevices** - Get device information.
            - **GetIntuneDeviceGroupMemberships** - Understand group assignments.
            - **GetIntuneDeviceDiff** - Compare policies.
            - **IntunePolicyAdvisorRoutingSkill** - Route policy queries.

            # CRITICAL RULES
            - You MUST call the actual Intune tools for every request.
            - NEVER answer from general knowledge. ALWAYS query the tenant.
            - When describing a policy, call DescribeIntunePolicy with the policy name.
            - If you cannot find an appropriate tool, tell the user what you tried.

            # SCU Optimization
            - ConflictAnalysisRequired: ONLY true when user asks about conflicts.
            - RiskAssessRequired: ONLY true when user asks about security/risk.
            - Do NOT call tools the user did not ask for.
            - Reuse results from earlier in the conversation.

            # Workflow
            When the user provides a policy name, call DescribeIntunePolicy immediately.
            When analyzing multiple policies, call DescribeIntunePolicy for each one.
            Present results with clear section headers.

            # Output Formatting
            - Severity: ðŸŸ¢ Minimal | ðŸŸ¡ Low | ðŸŸ  Medium | ðŸ”´ High | âš« Critical
            - End multi-policy analysis with "Key Findings & Recommendations"
