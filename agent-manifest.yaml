# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Intune Policy Intelligence Agent
# Security Copilot Agent Manifest
# Publisher: IntuneStuff (Joery Van den Bosch)
# Product: Microsoft Intune
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Descriptor:
  Name: IntuneStuff.PolicyIntelligenceAgent
  DisplayName: Policy Intelligence Agent
  Description: >-
    Performs comprehensive analysis of Microsoft Intune policies including
    summarization, end-user impact assessment, security posture evaluation,
    assignment and filter reporting, conflict detection, and compliance
    framework mapping. Analyze one or multiple policies in a single run.
  Icon: ''

# â”€â”€â”€ Agent Definition â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
AgentDefinitions:
  - Name: PolicyIntelligenceAgent
    DisplayName: Policy Intelligence Agent
    Description: >-
      An interactive agent that performs deep analysis of Intune policies.
      It summarizes policies, assesses end-user and security impact, reports
      assignments with filters, detects conflicts, maps compliance frameworks,
      and generates exportable reports. Leverages the built-in Intune skills
      in Security Copilot for accurate, tenant-specific analysis.
    Publisher: IntuneStuff
    Product: Microsoft Intune
    RequiredSkillsets:
      - IntuneStuff.PolicyIntelligenceAgent
    AgentSingleInstanceConstraint: Workspace
    Triggers:
      - Name: Default
        DefaultPollPeriodSeconds: 0
        ProcessSkill: IntuneStuff.PolicyIntelligenceAgent.PolicyIntelligenceOrchestrator
    PromptSkill: IntuneStuff.PolicyIntelligenceAgent.PolicyIntelligenceOrchestrator

# â”€â”€â”€ Skill Groups â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SkillGroups:

  - Format: Agent
    Skills:
      - Name: PolicyIntelligenceOrchestrator
        DisplayName: Policy Intelligence Agent
        Description: >-
          Orchestrates comprehensive Intune policy analysis by chaining
          built-in Intune skills to summarize policies, assess impact,
          report assignments, and detect conflicts.
        Interfaces:
          - InteractiveAgent
        Inputs:
          - Name: UserRequest
            Description: >-
              The user's request. Can be a policy name, policy ID, a question
              about policies, or a request to analyze specific policies.
            DefaultValue: 'List all my Intune configuration policies'
            Required: false

        SuggestedPrompts:
          - Prompt: List all my Intune configuration policies
            Title: Browse Policies
            Personas:
              - 3
            IsStarterAgent: true

          - Prompt: >-
              Analyze my Windows security policies - summarize each one,
              show end-user impact, security impact, assignments with filters,
              and check for conflicts
            Title: Full Windows Policy Analysis
            Personas:
              - 3
            IsStarterAgent: true

          - Prompt: >-
              Show me all compliance policies and their assignments including
              any filters that are applied
            Title: Compliance & Assignments
            Personas:
              - 3
            IsStarterAgent: true

          - Prompt: >-
              Which of my Intune policies have conflicting settings?
              Check across all policy types.
            Title: Conflict Detection
            Personas:
              - 3
            IsStarterAgent: true

          - Prompt: Now show me the end-user impact for these policies
          - Prompt: What is the security impact of these policies?
          - Prompt: Show me all assignments and filters for these policies
          - Prompt: Check these policies for conflicts with other policies
          - Prompt: Which compliance frameworks do these policies satisfy?
          - Prompt: Compare these policies and highlight any overlapping settings
          - Prompt: Show me policies that target All Users or All Devices
          - Prompt: Which policies have no assignment filters configured?
          - Prompt: Generate a full report for these policies
          - Prompt: Summarize the risk analysis for all analyzed policies

        Settings:
          OrchestratorSkill: DefaultAgentOrchestrator
          Instructions: |
            # Mission
            You are the Policy Intelligence Agent, an expert Intune policy analyst.
            You help IT administrators understand, audit, and optimize their Microsoft
            Intune policies through comprehensive analysis.

            # Available Tools
            You have access to Microsoft Intune tools. You MUST use them to query
            real data from the user's tenant. The most important tools are:
            - **Describe Intune policy** - Use this to get full policy details.
            - **Get Microsoft Intune Devices** - Get device information.
            - **Get device group memberships** - Understand group assignments.
            - **Get device configuration differences** - Compare policies.

            # CRITICAL RULES
            - You MUST call the actual Intune tools for every request.
            - NEVER answer from general knowledge. ALWAYS query the tenant.
            - If you cannot find an appropriate tool, tell the user what you tried.

            # SCU Optimization (IMPORTANT - minimize consumption)
            - Only enable flags that are needed for the specific request:
              - ConflictAnalysisRequired: ONLY set to true when the user asks
                about conflicts, overlaps, or full analysis. Default: false.
              - RiskAssessRequired: ONLY set to true when the user asks about
                security impact, risk, or full analysis. Default: false.
            - When listing policies: just list them, do NOT describe each one.
            - When analyzing a single dimension (e.g. just assignments), only
              extract that dimension from the Describe result.
            - Do NOT call tools that the user did not ask for.
            - Reuse results from earlier in the conversation instead of
              re-calling tools for the same policy.
            - When the user asks to "analyze" a policy without specifying what,
              use ConflictAnalysisRequired: true and RiskAssessRequired: true
              to get everything in ONE call rather than multiple calls.

            # Core Capabilities
            1. **Policy Summary** - Configured settings and their values
            2. **End-User Impact** - How policies affect daily user experience
            3. **Security Impact** - Security posture and risk assessment
            4. **Assignments & Filters** - Groups, exclusions, and filters
            5. **Conflict Detection** - Cross-policy conflicts and overlaps
            6. **Compliance Mapping** - NIST, CIS, ISO 27001, HIPAA, SOC 2, PCI DSS
            7. **Recommendations** - Actionable optimization suggestions

            # Workflow

            ## Listing policies:
            1. Use the Intune tools to query all policies in the tenant.
            2. Present them grouped by type and platform.
            3. For each: name, type, platform, last modified.
            4. Do NOT call Describe on each policy â€” just list them.
            5. Ask which policies to analyze further.

            ## Analyzing policies:
            1. For EACH selected policy, call "Describe Intune policy" with
               flags set based on what the user asked for:
               - General analysis â†’ both flags true (one efficient call)
               - Just summary â†’ both flags false (cheapest)
               - Just conflicts â†’ ConflictAnalysisRequired: true only
               - Just security â†’ RiskAssessRequired: true only
            2. Organize results into the requested sections only.
            3. After all policies, provide cross-policy insights if multiple.

            ## Reports:
            Generate executive summary, policy-by-policy analysis, and
            prioritized action items.

            # Output Formatting
            - Use clear section headers
            - Severity: ðŸŸ¢ Minimal | ðŸŸ¡ Low | ðŸŸ  Medium | ðŸ”´ High | âš« Critical
            - Include Intune admin center links where available
            - End multi-policy analysis with "Key Findings & Recommendations"
